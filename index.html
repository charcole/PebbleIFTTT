<!DOCTYPE html>
<html>
  <head>
  <title>Slate Example Configuration</title>
  <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
  <script src='js/slate.min.js'></script>
  <style>
  .title {
    padding: 15px 10px;
    text-transform: uppercase;
    font-family: 'PT Sans', sans-serif;
    font-size: 1.2em;
    font-weight: 500;
    color: #888888;
    text-align: center;
  }
  </style>
  </head>

  <body>
    <h1 class='title'>Pebble IFTTT Configuration</h1>

    <div class='item-container'>
      <div class='item-container-content'>
        <div class='item'>
          Use this configuration page to add new options to add triggers using the Maker channel on If This Then That (IFTTT).
        </div>
      </div>
    </div>

    <div class='item-container'>
      <div class='item-container-header'>Customizability</div>
      <div class='item-container-content'>
        <label class='item'>
          Menu Configuration<br>
          <textarea rows="8" cols="100%" form="area" id="menu">Name to appear in menu:YourIFTTTMakerEventName
Sub Menu
Pick A:testa
Pick B:testb

Another Sub Menu
Pick A:testc
Pick B:testd</textarea>
        </label>
      </div>
      <div class='item-container-footer'>
        IFTTT events to appear in menu are specified as [Item Text]:[IFTTT Maker Event Name]. Add as many as you like. Sub menus can be made by adding the name of the sub menu on its own line. Everything will appear under that sub menu until the next empty line. You can nest multiple sub menus using this approach.
      </div>
    </div>

    <div class='item-container'>
      <div class='item-container-header'>Keys</div>
      <div class='item-container-content'>
        <label class='item'>
          IFTTT Maker Key<br>
          <input id='keybox' type='text' value="SomeLongListOfCharacters">
        </label>
      </div>
      <div class='item-container-footer'>
        You can find your key at <a href="https://ifttt.com/maker">IFTTT Maker</a>
      </div>
    </div>

    <div class='item-container'>
      <div class='button-container'>
        <input id='submit_button' type='button' class='item-button' value='SAVE'>
      </div>
    </div>
  </body>
  <script>
  function getConfigData() {
    var menuTextbox = document.getElementById('menu');
    var keyTextbox = document.getElementById('keybox');
 
    var options = {
      'menu': menuTextbox.value,
      'keybox': keyTextbox.value
    };

    // Save for next launch
    localStorage['menu'] = options['menu'];
    localStorage['keybox'] = options['keybox'];

    console.log('Got options: ' + JSON.stringify(options));
    return options;
  }

  function getQueryParam(variable, defaultValue) {
    var query = location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return defaultValue || false;
  }
 
  var submitButton = document.getElementById('submit_button');
  submitButton.addEventListener('click', function() {
    console.log('Submit');

    // Set the return URL depending on the runtime environment
    var return_to = getQueryParam('return_to', 'pebblejs://close#');
    document.location = return_to + encodeURIComponent(JSON.stringify(getConfigData()));
  });

  (function() {
    var menuTextbox = document.getElementById('menu');
    var keyTextbox = document.getElementById('keybox');

    // Load any previously saved configuration, if available
    if(localStorage['keybox']) {
      keyTextbox.value = localStorage['keybox'];
      menuTextbox.value = localStorage['menu'];
    }
  })();
  </script>
</html>
